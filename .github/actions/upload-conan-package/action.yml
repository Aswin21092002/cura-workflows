# composite action, not to be run on its own, but included in a build script

name: 'Upload conan packages'
description: 'Uploads one or multiple conan packages, to either the public or private repository'

inputs:
  package_name:
    required: false
    default: "*"
    type: string


runs:
  using: "composite"
  steps:
      - name: Upload the Package(s)
        shell: bash
        run: |
          if [[ -f pydir.txt ]]; then
            pydir=$(cat pydir.txt)
            PATH+=":$pydir:$pydir/Scripts"
          fi

          packages=$(conan list -c "${{ inputs.package_name }}" -f json | jq -r '.["Local Cache"] | keys[] ')

          for package in $packages; do
            if [[ $package == *"@internal"* ]]; then
              conan upload "${{ inputs.package_name }}" -r cura-private-conan2 -c
            else
              conan upload "${{ inputs.package_name }}" -r cura-conan2 -c
            fi
          done
